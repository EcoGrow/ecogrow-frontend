<div align="center">

![free-icon-globe-6004805](https://github.com/user-attachments/assets/c76cd0df-111f-437c-a1df-161a2afe7e44)


### 🖥️ Eco Grow 🖥️
[<img src="https://img.shields.io/badge/프로젝트 기간-2024.09.10~2024.11.27-green?style=flat&logo=&logoColor=white" />]()

</div> 

## 📝 프로젝트 소개

- 한림대학교 Software Capston Design
- 프로젝트명 : Eco Grow
- 내용 : 버리는 쓰레기를 시각화하고 사용자에게 맞춤형 쓰레기 감소 팁을 제공하며 제로웨이스트 제품을 추천하는 서비스

<br>


## 💁‍♂️ 프로젝트 팀원

|리더|팀원|팀원|
|:---:|:---:|:---:|
|![file](https://github.com/user-attachments/assets/ee9604ee-9f3a-4075-a047-5f7857ebc60b)|![file (2)](https://github.com/user-attachments/assets/4d1fe5a2-611f-4e64-87d2-853673326fe8)||![file (1)](https://github.com/user-attachments/assets/4d1fe5a2-611f-4e64-87d2-853673326fe8)|
|[김경민]((https://github.com/gminnimk))|[서찬영]()|[석연걸]()|

<br />

## 🧑‍💻 팀 역할
| 역할 | 리더 김경민| 팀원 서찬영 | 팀원 석연걸 |
|:---:|:---:|:---:|:---:|
| 담당 기능 | <ul><li>사용자 인증</li><li>소셜 로그인(Kakao, Google)</li><li>관리자 기능</li><li>쓰레기 기록 CRUD</li><li>맞춤형 쓰레기 감소 TIP</li><li>제로웨이스트 제품 추천 기능</li><li>Front</li><li>AOP</li><li>배포</li>|<ul><li>회원가입 & 로그인 페이지</li><li>프로필</li><li>커뮤니티 기능<li></li>뉴스 API</li><li>실시간 채팅</li> |<ul><li>2D 이스터에그 게임</li><li>3D 분리수거 게임</li><li>Front</li>|

<br>


## 📜 임시 최종 기획안 및 진행 사항

https://docs.google.com/document/d/1TwYGpixl2F0x2VR9XR31Se2Bs0SiQ6iTBjHi4AA-Hdw/edit?usp=sharing

<br>

## 🗂️ APIs

- 추후 추가 예정

<br />

## 🖥 ERD 다이어그램 

- 추후 개선 예정

![image](https://github.com/user-attachments/assets/1070bd4e-4038-4e4c-a0ed-e2e52e0eefe9)


<br>

## 🛠️ Tech Stacks

### ■ Back-end

<div>
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Java.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/SpringBoot.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/SpringSecurity.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/SpringDataJPA.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Mysql.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Thymeleaf.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/JWT.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Qeurydsl.png?raw=true" width="80">
</div>

- JDK 17.0.11
- Dependencies
  - Spring Boot: data-jpa, data-jdbc, security, 유효성 검사, 웹, 테스트, devtools, oauth2-client(기본 버전)
  - Lombok: compileOnly, AnnotationProcessor(기본 버전)
  - MySQL 커넥터: RuntimeOnly(기본 버전)
  - JWT: jjwt-api, jjwt-impl, jjwt-jackson(0.11.5)
  - QueryDSL: querydsl-jpa(5.0.0), querydsl-apt(querydsl.version 기반 기본 버전)
  - Jakarta : Annotation-api, persistence-api(기본 버전)
  - MapStruct: mapstruct(1.5.5.Final), mapstruct-processor(1.5.5.Final)
  - JUnit: junit-platform-launcher(기본 버전)

<br>

### ■ Front
<div>
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/React.png?raw=true?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/JavaScript.png?raw=true" width="80">
</div>

<br>

### ■ Infra

<div>
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Docker.png?raw=true" width="80">
<img src="https://github.com/user-attachments/assets/c305b269-2996-4316-9d06-5a99b60dc829" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/AWSEC2.png?raw=true" width="80">
</div>

<br>

### ■ Tools
<div>
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Github.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Notion.png?raw=true" width="80">
<img src="https://github.com/yewon-Noh/readme-template/blob/main/skills/Postman.png?raw=true" width="80">
</div>
          
<br>


## 🛠️ 프로젝트 아키텍쳐

- 추후 추가 예정
  
<br>


## 📄 시연 영상

- 24년 11월 10일 기준 중간 시연 영상입니다.

https://youtu.be/sOdrZyGFin0

<br>

## 🗣️기술적 의사결정

- 추후 추가 예정

<br>

## 🤔 Trouble Shoothing

<details>
  <summary>양방향 참조 문제</summary>

<br>

📢 WasteRecord 와 WasteItem 간의 양방향 참조 문제

➡️ 오류 내용


- WasteRecord는 다시 WasteItem 리스트를 참조하면서 무한 순환 참조가 발생하여 JSON 직렬화 시 깊이 제한을 초과하는 문제가 발생

2024-10-27T19:17:39.304+09:00 WARN 24252 --- [ecogrow-backend][nio-8080-exec-7] .w.s.m.s.DefaultHandlerExceptionResolver : Ignoring exception, response committed already: org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Document nesting depth (1001) exceeds the maximum allowed (1000, from StreamWriteConstraints.getMaxNestingDepth())

2024-10-27T19:17:39.304+09:00 WARN 24252 --- [ecogrow-backend][nio-8080-exec-7] .w.s.m.s.DefaultHandlerExceptionResolver : Resolved [org.springframework.http.converter.HttpMessageNotWritableException: Could not write JSON: Document nesting depth (1001) exceeds the maximum allowed (1000, from StreamWriteConstraints.getMaxNestingDepth())]



➡️ 원인 :

- 양방향 탐색
 
  - WasteRecord를 직렬화할 때 직렬 변환기는 wasteItems를 포함한 모든 필드를 포함하게 됨.
    
  - wasteItems의 각 WasteItem에 대해 직렬 변환기는 WasteRecord를 다시 참조하는 wasteRecord를 포함한 모든 필드를 포함하게 됨.

  - 즉 WasteRecord -> WasteItem -> WasteRecord -> WasteItem -> (무한히 계속).


➡️ 해결 방법 :

- @JsonIgnoreProperties 사용

- 주석으로 이 체인을 끊음으로 JSON 직렬화 중 순환 참조를 방지하는 동시에 Java 코드에서 양방향 관계를 그대로 유지

@JsonIgnoreProperties("wasteRecord")
private List<WasteItem> wasteItems = new ArrayList<>();


@JsonManagedReference 및 @JsonBackReference: 이는 JSON에서 관리되는 부모-자식 관계를 생성하여 "부모" 측(WasteRecord를 WasteItem으로)만 직렬화하고 "하위 항목에서 재귀를 방지합니다. " 측면(WasteItem에서 WasteRecord까지).


<br>

</details>
<details>
  <summary>특정 사용자에 대한 프로필 조회</summary>

<br>

📢 Spring Boot의 모호한 핸들러 매핑

- 쓰레기 기록 메인 페이지에서 인증된 특정 사용자의 특정 게시글을 클릭하면 특정 데이터를 가지고 있는 쓰레기 기록 상세 페이지를 조회하는데 실패하는 상황


- ➡️ 오류 내용

2024-10-29T20:30:10.827+09:00 ERROR 628 --- [ecogrow-backend][nio-8080-exec-8] o.a.c.c.C.[.[.[/].[dispatcherServlet] : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: java.lang.IllegalStateException: Ambiguous handler methods mapped for '/api/waste/record/3': {public org.springframework.http.ResponseEntity com.sw.ecogrowbackend.domain.waste.controller.WasteRecordController.getWasteRecords(java.lang.Long), public org.springframework.http.ResponseEntity com.sw.ecogrowbackend.domain.waste.controller.WasteRecordController.getWasteRecord(java.lang.Long)}] with root cause java.lang.IllegalStateException: Ambiguous handler methods mapped for '/api/waste/record/3': {public org.springframework.http.ResponseEntity com.sw.ecogrowbackend.domain.waste.controller.WasteRecordController.getWasteRecords(java.lang.Long), public org.springframework.http.ResponseEntity com.sw.ecogrowbackend.domain.waste.controller.WasteRecordController.getWasteRecord(java.lang.Long)} at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.lookupHandlerMethod(AbstractHandlerMethodMapping.java:431) ~[spring-webmvc-6.1.12.jar:6.1.12] at org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.getHandlerInternal(AbstractHandlerMethodMapping.java:382) ~[spring-webmvc-6.1.12.jar:6.1.12] at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:127) ~[spring-webmvc-6.1.12.jar:6.1.12] at org.springframework.web.servlet.mvc.method.RequestMappingInfoHandlerMapping.getHandlerInternal(RequestMappingInfoHandlerMapping.java:68) ~[spring-webmvc-6.1.12.jar:6.1.12] at org.springframework.web.servlet.handler.AbstractHandlerMapping.getHandler(AbstractHandlerMapping.java:507) ~[spring-webmvc-6.1.12.jar:6.1.12] at


➡️ 원인 :

- 쓰레기 기록에 관한 controller 에서 동일한 경로 /api/waste/record/{id}에 매핑된 두 개의 핸들러 메서드가 있기 때문.

- getWasteRecord(@PathVariable Long RecordId): recordId로 단일 폐기물 기록을 가져오기 위해 /api/waste/record/{recordId}에 매핑

- getWasteRecords(@PathVariable Long userId): userId를 기반으로 특정 사용자에 대한 모든 레코드를 가져오기 위한 /api/waste/record/{userId}에도 매핑

- 두 메소드 모두 동일한 기본 경로(/api/waste/record/{id})를 사용하기 때문에 Spring은 경로 변수를 사용하여 이 경로에 요청이 이루어질 때 사용할 핸들러 메소드를 결정할 수 없으며 '모호한 핸들러'가 발생.

➡️ 해결 방법 :

- 문제를 해결하기 위해 하나의 경로를 변경하면 됨.

- '기록' 이라는 용어는 개별 항목과 더 밀접하게 연관되어 있으므로 단일 기록 검색을 /api/waste/record/{recordId}
에 유지하고 사용자별 기록을 '/api/waste/record/user/{userId}로 최신화 하는 것이 좋음

<br>

  <details>
 </details>

<br>

